# 如何理解P分位数？（P99之类）
考察一个服务的性能时，除了考虑QPS，还会考察响应时间。当服务器负载升高，一般响应时间都会增长。P分位数是对响应时间的一种度量。

P95：将一段时间内的响应耗时从小到大排列，顺序处于95%的响应时间就是P95。例如：一个服务的P95=180ms，则表示95%的用户的请求的响应耗时都在180ms内，仅有5%的用户响应耗时大于180ms。
（P99就是99%的响应耗时都不超过这个数；P50则刚好是响应耗时的中位数。）

为什么不用响应耗时的平均数？（小学生都会答）1. 平均值容易受极端值影响；2.另一方面，在考察系统性能时，部分异常值的出现相当于是某种异常场景的警告，不能完全忽视。平均值也容易掩盖这种异常。

# 怎么计算较长一段时间内的P分位数值？
（问题提出：一般一个QPS=100的服务在1小时内的请求总数是360000.对如此庞大的数据量进行排序再取百分位在性能上是不可接受的。）

分桶计算是一种方案（类似直方图）：将响应耗时划分为不同的范围，一个范围就是一个桶。根据每个桶的数量，就可以判断出比方说95%的位置处于哪个桶。然后在这个桶内做插值、或者桶内平均来估出来一个P95。

同时考虑到异常的响应耗时的占比不会很高，桶的范围划分可以不是均匀的。（甚至指数划分都可以。）